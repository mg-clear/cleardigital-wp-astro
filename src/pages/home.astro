---
import BaseLayout from '@layouts/BaseLayout/BaseLayout.astro';
import HeroImageCta from '@components/HeroImageCta/HeroImageCta.astro';
import ImageTwoBlock from '@components/ImageTwoBlock/ImageTwoBlock.astro';
import ContentWithGrid from '@components/ContentWithGrid/ContentWithGrid.astro';
import TabsWithContent from '@components/TabsWithContent/TabsWithContent.astro';
import SliderWithContent from '@components/SliderWithContent/SliderWithContent.astro';
import TwoGridSlider from '@components/TwoGridSlider/TwoGridSlider.astro';

const response = await fetch(
  'https://tbd-clear-astro-wp.pantheonsite.io/graphql',
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      query: `
        query NewQuery {
          page(id: "7", idType: DATABASE_ID) {
            title
            pageComponents {
              pageComponents {
                ... on Page_Pagecomponents_PageComponents_HeroImageCta {
                  eyebrow
                  fieldGroupName
                  theme
                  backgroundImage {
                    altText
                    sourceUrl
                  }
                  backgroundVideo
                  ctaText
                  ctaUrl
                  headline
                  ctaTarget
                  ctaVariant
                  hasOverlayGrid
                  headlineTag
                  headlineVariant
                }
              }
            }
          }
        }
      `,
    }),
  }
);

const json = await response.json();
const {
  title,
  pageComponents: { pageComponents },
} = json.data.page;

console.log(pageComponents);

const componentMapping = {
  Page_Pagecomponents_PageComponents_HeroImageCta: HeroImageCta,
};
---

<BaseLayout title={title} metaDescription="">
  {
    pageComponents.map((componentProps: any) => {
      const layout = componentProps.fieldGroupName;
      const Component = componentMapping[layout];

      return Component && <Component {...componentProps} />;
    })
  }
</BaseLayout>
